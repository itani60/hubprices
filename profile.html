<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>My Profile | CompareHub</title>
    <link rel="stylesheet" href="profile.css">
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/amazon-cognito-identity-js/6.3.3/aws-cognito-sdk.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/amazon-cognito-identity-js@6.3.3/dist/amazon-cognito-identity.min.js"></script>
    <script src="https://sdk.amazonaws.com/js/aws-sdk-2.1.24.min.js"></script>
</head>
<body>
    <header class="header">
        <div class="header-top">
            <button class="sidebar-toggle" onclick="toggleSidebar()">â˜°</button>
            <div class="logo">
                <a href="index.html" class="logo-link">
                    <img src="https://comparehub-smartphone-images.s3.af-south-1.amazonaws.com/IMG_20250625_174144.jpg" alt="CompareHubPrices" class="logo-image">
                </a>
            </div>
            <div class="search-container">
                <form id="search-form" onsubmit="performSearch(event)">
                    <input type="text" name="q" class="search-input" placeholder="What are you shopping for?" id="searchInput">
                    <button type="submit" class="search-button"><i class="fas fa-search"></i></button>
                </form>
                <div class="search-suggestions" id="searchSuggestions">
                    <div class="suggestions-header">
                        <span class="all-results">All</span>
                        <span class="search-query" id="searchQuery">results</span>
                    </div>
                    <div class="suggestions-grid" id="suggestionsGrid"></div>
                </div>
            </div>
        </div>
        <nav class="category-nav">
            <a href="best-deals.html" class="active"><i class=""></i> Best deals</a>
            <a href="#new-arrivals"><i class=""></i> New Arrivals</a>
            <a href="#wishlist" id="wishlist-link"><i class="fas fa-heart"></i> Wishlist</a>
        </nav>
    </header>

    <div class="main-container">
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-login" id="sidebarLogin"></div>
            <div class="sidebar-search">
                <input type="text" placeholder="Search categories..." id="sidebarSearchInput">
            </div>
            <div class="sidebar-header">
                <h3>Browse Categories</h3>
                <button class="close-sidebar" onclick="closeSidebar()">&times;</button>
            </div>
            <div class="menu-content">
                <!-- [SIDEBAR MENU, UNCHANGED FROM YOUR INPUT, PASTE FULL BLOCK HERE FOR YOUR FINAL USAGE] -->
                <ul class="menu-items">
                    <!-- ... all your <li class="item"> ... structure ... -->
                    <!-- [PASTE YOUR PROVIDED SIDEBAR MENU CONTENT HERE] -->
                    <!-- ... content omitted for brevity ... -->
                </ul>
            </div>
            <div class="sidebar-footer">
                <div class="cookie-notice">
                    <p>This website uses cookies to provide you with the best experience.</p>
                    <button class="accept-cookies" onclick="acceptCookies()">Accept</button>
                </div>
            </div>
        </nav>
        
        <main class="content">
            <div class="profile-container">
                <!-- Profile Sidebar -->
                <div class="profile-sidebar">
                    <div class="profile-avatar">
                        <div class="avatar-image" id="avatarInitials">
                            JD
                            <button class="avatar-upload">
                                <i class="fas fa-camera"></i>
                            </button>
                        </div>
                        <div class="profile-name" id="profileName"></div>
                        <div class="profile-email" id="profileEmail"></div>
                    </div>
                    <ul class="profile-nav">
                        <li><a href="#" class="nav-link active" data-section="profile-info"><i class="fas fa-user"></i> Profile Information</a></li>
                        <li><a href="#" class="nav-link" data-section="wishlist"><i class="fas fa-heart"></i> My Wishlist</a></li>
                        <li><a href="#" class="nav-link" data-section="notifications"><i class="fas fa-bell"></i> Notifications</a></li>
                        <li><a href="#" class="nav-link" data-section="settings"><i class="fas fa-cog"></i> Settings</a></li>
                        <li><a href="#" class="nav-link" data-section="privacy"><i class="fas fa-shield-alt"></i> Privacy & Security</a></li>
                    </ul>
                </div>
                <div class="profile-main">
                    <div class="profile-header">
                        <h1 id="section-title">Profile Information</h1>
                    </div>
                    <div class="profile-content">
                        <div id="profile-info" class="profile-section active">
                            <div class="stats-grid">
                                <div class="stat-card">
                                    <div class="stat-value" id="wishlistCount">0</div>
                                    <div class="stat-label">Wishlist Items</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="totalSavings">R0</div>
                                    <div class="stat-label">Total Savings</div>
                                </div>
                                <div class="stat-card">
                                    <div class="stat-value" id="alertsCount">0</div>
                                    <div class="stat-label">Price Alerts</div>
                                </div>
                            </div>
                            <form id="profile-form">
                                <div class="form-row">
                                    <div class="form-group">
                                        <label for="firstName">First Name</label>
                                        <input type="text" id="firstName" name="firstName" value="">
                                    </div>
                                    <div class="form-group">
                                        <label for="lastName">Last Name</label>
                                        <input type="text" id="lastName" name="lastName" value="">
                                    </div>
                                </div>
                                <div class="form-group">
                                    <label for="email">Email Address</label>
                                    <input type="email" id="email" name="email" value="">
                                </div>
                                <div class="form-group">
                                    <button type="submit" class="btn">Update Profile</button>
                                    <button type="button" class="btn btn-secondary">Cancel</button>
                                </div>
                            </form>
                        </div>
                        <div id="wishlist" class="profile-section">
                            <div class="wishlist-search-wrapper">
                                <div class="wishlist-search-container">
                                    <input type="text" id="wishlistSearch" placeholder="Search wishlist..." class="wishlist-search-input">
                                    <button id="clearWishlistSearch" class="clear-search-btn" style="display: none;">
                                        <i class="fas fa-times"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="wishlist-grid" id="wishlistGrid"></div>
                            <div id="empty-wishlist" class="empty-wishlist" style="display: none;">
                                <i class="far fa-heart"></i>
                                <p>Your wishlist is empty</p>
                                <p class="empty-wishlist-subtext">Add items to your wishlist by clicking the heart icon on products</p>
                            </div>
                        </div>
                        <div id="notifications" class="profile-section">
                            <div id="notificationsList"></div>
                        </div>
                        <div id="settings" class="profile-section">
                            <form id="settings-form">
                                <div class="form-group">
                                    <label for="emailNotifications">
                                        <input type="checkbox" id="emailNotifications" checked>
                                        Email notifications for price drops
                                    </label>
                                </div>
                                <div class="form-group">
                                    <button type="submit" class="btn">Save Settings</button>
                                </div>
                            </form>
                        </div>
                        <div id="privacy" class="profile-section">
                            <form id="privacy-form">
                                <div class="form-group">
                                    <label for="currentPassword">Current Password</label>
                                    <input type="password" id="currentPassword" name="currentPassword">
                                </div>
                                <div class="form-group">
                                    <label for="newPassword">New Password</label>
                                    <input type="password" id="newPassword" name="newPassword">
                                </div>
                                <div class="form-group">
                                    <label for="confirmPassword">Confirm New Password</label>
                                    <input type="password" id="confirmPassword" name="confirmPassword">
                                </div>
                                <div class="form-group">
                                    <button type="submit" class="btn">Change Password</button>
                                </div>
                                <hr style="margin: 30px 0;">
                                <div class="form-group">
                                    <button type="button" class="btn btn-logout" id="logoutBtn">
                                        <i class="fas fa-sign-out-alt"></i> Logout
                                    </button>
                                    <button type="button" class="btn" style="background: #dc3545;">Delete Account</button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>
    
    <!-- Wishlist Modal -->
    <div id="wishlist-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-actions">
                    <a href="#" class="view-all-btn nav-link" data-section="wishlist">View All</a>
                    <button class="remove-all-btn" id="clear-wishlist-btn">Remove All</button>
                    <span class="close-modal">&times;</span>
                </div>
            </div>
            <div class="modal-body">
                <div id="wishlist-items" class="wishlist-grid">
                    <!-- Wishlist items will be populated here -->
                </div>
                <div id="modal-empty-wishlist" class="empty-wishlist" style="display: none;">
                    <i class="far fa-heart"></i>
                    <p>Your wishlist is empty</p>
                    <p class="empty-wishlist-subtext">Add items to your wishlist by clicking the heart icon on products</p>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Custom Confirmation Dialog -->
    <div id="confirmation-dialog" class="modal">
        <div class="modal-content confirmation-modal">
            <div class="confirmation-header">
                <h3 id="confirmation-title">Confirmation</h3>
            </div>
            <div class="confirmation-body">
                <p id="confirmation-message">Are you sure you want to proceed?</p>
            </div>
            <div class="confirmation-footer">
                <button id="confirmation-cancel" class="confirmation-btn cancel-btn">Cancel</button>
                <button id="confirmation-confirm" class="confirmation-btn confirm-btn">Confirm</button>
            </div>
        </div>
    </div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>About CompareHubPrices</h3>
                <ul>
                    <li><a href="#about">About Us</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Help & Support</h3>
                <ul>
                    <li><a href="#contact">Contact Us</a></li>
                    <li><a href="#faq">FAQs</a></li>
                    <li><a href="#privacy">Privacy Policy</a></li>
                    <li><a href="#terms">Terms of Service</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Connect With Us</h3>
                <div class="social-icons">
                    <a href="#" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
                    <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                    <a href="#" aria-label="LinkedIn"><i class="fab fa-linkedin"></i></a>
                    <a href="#" aria-label="Pinterest"><i class="fab fa-pinterest"></i></a>
                </div>
                <div class="newsletter-section">
                    <h4>Get the Best Deals in Your Inbox</h4>
                    <form class="newsletter-form" onsubmit="subscribeNewsletter(event)">
                        <input type="email" placeholder="Enter your email address" required aria-label="Email address for newsletter">
                        <button type="submit"><i class="fas fa-paper-plane"></i> Subscribe</button>
                    </form>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 CompareHub Prices. All rights reserved.</p>
        </div>
    </footer>
<script>
/* Sidebar login/profile logic */
function getInitials(str) {
    if (!str) return "";
    let [name] = str.split('@');
    let parts = name.split(/[.\-_]/);
    if (parts.length > 1) return (parts[0][0] + parts[1][0]).toUpperCase();
    return name[0].toUpperCase();
}

function renderSidebarLogin() {
    const sidebarLogin = document.getElementById('sidebarLogin');
    const email = localStorage.getItem('userEmail');
    const name = localStorage.getItem('userName') ||
        (email ? email.split('@')[0].replace(/\./g, ' ').replace(/(^|\s)\S/g, l => l.toUpperCase()) : '');
    const avatar = localStorage.getItem('userAvatarUrl');
    if (email) {
        sidebarLogin.innerHTML = `
            <div class="user-greeting fade-in">
                <div class="user-avatar" style="cursor:pointer;">
                    ${avatar ? `<img src="${avatar}" alt="Avatar">` : getInitials(name || email)}
                </div>
                <div class="user-info">
                    <div class="user-name">${name}</div>
                    <div class="user-email">${email}</div>
                    <span class="sign-out" style="cursor:pointer;">Sign Out</span>
                </div>
            </div>
        `;
        // Avatar click goes to profile.html (already here, but keep for UX consistency)
        const avatarEl = sidebarLogin.querySelector('.user-avatar');
        if (avatarEl) avatarEl.onclick = function(event) {
            event.preventDefault();
            event.stopPropagation();
            window.location.href = "profile.html";
        };
        // Sign out clears localStorage and redirects to index.html
        const signOutEl = sidebarLogin.querySelector('.sign-out');
        if (signOutEl) signOutEl.onclick = function(event) {
            event.preventDefault();
            event.stopPropagation();
            localStorage.removeItem('userEmail');
            localStorage.removeItem('userAvatarUrl');
            localStorage.removeItem('userName');
            window.location.href = "index.html";
        };
    } else {
        // Login button goes to login.html
        sidebarLogin.innerHTML = `
            <a href="login.html" class="login-btn" id="sidebarLoginBtn">
                <i class="fas fa-sign-in-alt"></i>Login to CompareHub
            </a>
        `;
        const loginBtn = document.getElementById('sidebarLoginBtn');
        if (loginBtn) loginBtn.onclick = function(event) {
            event.preventDefault();
            window.location.href = "login.html";
        };
    }
}

window.toggleSidebar = function() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebarOverlay');
    sidebar.classList.toggle('active');
    overlay.classList.toggle('active');
};

window.closeSidebar = function() {
    const sidebar = document.getElementById('sidebar');
    const overlay = document.getElementById('sidebarOverlay');
    sidebar.classList.remove('active');
    overlay.classList.remove('active');
};

window.toggleSubmenu = function(element) {
    const item = element.parentElement;
    const isActive = item.classList.contains('active');
    document.querySelectorAll('.item.active').forEach(activeItem => {
        if (activeItem !== item) activeItem.classList.remove('active');
    });
    item.classList.toggle('active');
    if (!isActive) {
        const submenuItems = item.querySelectorAll('.submenu .item');
        submenuItems.forEach((submenuItem, index) => {
            setTimeout(() => {
                submenuItem.classList.add('slide-in');
            }, index * 50);
        });
    }
};

window.goBack = function(element) {
    const item = element.closest('.item');
    item.classList.remove('active');
};

document.getElementById('sidebarSearchInput').addEventListener('input', function(e) {
    const searchTerm = e.target.value.toLowerCase();
    const menuItems = document.querySelectorAll('.menu-items .item');
    menuItems.forEach(item => {
        const text = item.textContent.toLowerCase();
        if (text.includes(searchTerm)) {
            item.style.display = 'block';
        } else {
            item.style.display = 'none';
        }
    });
});
renderSidebarLogin();
document.addEventListener('click', function(e) {
    const sidebar = document.getElementById('sidebar');
    const toggle = document.querySelector('.sidebar-toggle');
    const overlay = document.getElementById('sidebarOverlay');
    if (sidebar && !sidebar.contains(e.target) && e.target !== toggle && e.target !== overlay) {
        closeSidebar();
    }
});
window.acceptCookies = function() {
    const cookieNotice = document.querySelector('.cookie-notice');
    if (cookieNotice) cookieNotice.style.display = 'none';
};
window.subscribeNewsletter = function(event) {
    event.preventDefault();
    const input = event.target.querySelector('input[type="email"]');
    if (input && input.value) {
        alert('Thank you for subscribing!');
        input.value = '';
    }
};

/* Profile section navigation logic */
document.querySelectorAll('.profile-nav .nav-link').forEach(link => {
    link.addEventListener('click', function(e) {
        e.preventDefault();
        document.querySelectorAll('.profile-nav .nav-link').forEach(nav => nav.classList.remove('active'));
        this.classList.add('active');
        const section = this.getAttribute('data-section');
        document.querySelectorAll('.profile-section').forEach(sec => sec.classList.remove('active'));
        if (section) {
            document.getElementById(section).classList.add('active');
            document.getElementById('section-title').textContent = this.textContent.trim();
        }
    });
});

/* Logout button in privacy section */
document.getElementById('logoutBtn').addEventListener('click', function() {
    localStorage.removeItem('userEmail');
    localStorage.removeItem('userAvatarUrl');
    localStorage.removeItem('userName');
    window.location.href = "login.html";
});

/* Basic profile info fill from localStorage */
window.addEventListener('DOMContentLoaded', function() {
    // Avatar, name, email
    const email = localStorage.getItem('userEmail') || '';
    const name = localStorage.getItem('userName') || '';
    const initials = name ? name.split(' ').map(n => n[0]).join('').toUpperCase() : (email ? email[0].toUpperCase() : 'U');
    document.getElementById('avatarInitials').childNodes[0].nodeValue = initials;
    document.getElementById('profileName').textContent = name || email.split('@')[0] || '';
    document.getElementById('profileEmail').textContent = email;
    document.getElementById('email').value = email;
    // Stats (for demo, can be replaced with real API)
    document.getElementById('wishlistCount').textContent = localStorage.getItem('wishlistCount') || "0";
    document.getElementById('totalSavings').textContent = "R" + (localStorage.getItem('totalSavings') || "0");
    document.getElementById('alertsCount').textContent = localStorage.getItem('alertsCount') || "0";
});

/* Example: handle search box in header */
window.performSearch = function(event) {
    event.preventDefault();
    const searchInput = document.getElementById('searchInput');
    const query = searchInput.value.trim();
    if (query) {
        alert(`Searching for: ${query}`);
    }
};
/* Example: wishlist search (mock/UX only) */
document.getElementById('wishlistSearch').addEventListener('input', function(e) {
    const val = e.target.value;
    document.getElementById('clearWishlistSearch').style.display = val ? 'inline-block' : 'none';
});
document.getElementById('clearWishlistSearch').addEventListener('click', function() {
    document.getElementById('wishlistSearch').value = '';
    this.style.display = 'none';
});
</script>
</body>
</html>
