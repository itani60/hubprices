<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homepage - CompareHub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="hero-carousel-animations.css">
    <link rel="stylesheet" href="index.css">
    <style>
        @media screen and (min-width: 992px) {
            .search-container {
                width: 75%;
                max-width: 1000px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-top">
            <button class="sidebar-toggle" onclick="toggleSidebar()" aria-label="Open menu">â˜°</button>
            <div class="logo">
                <a href="index.html" class="logo-link">
                    <img src="https://comparehub-smartphone-images.s3.af-south-1.amazonaws.com/IMG_20250625_174144.jpg" alt="CompareHubPrices" class="logo-image">
                </a>
            </div>
            <div class="search-container">
                <form id="search-form" onsubmit="performSearch(event)">
                    <input type="text" name="q" class="search-input" placeholder="Search......." id="searchInput">
                    <button type="submit" class="search-button" aria-label="Search"><i class="fas fa-search"></i></button>
                </form>
                <div class="search-suggestions" id="searchSuggestions">
                    <div class="suggestions-header">
                        <span class="all-results">All</span>
                        <span class="search-query" id="searchQuery">results</span>
                    </div>
                    <div class="suggestions-grid" id="suggestionsGrid"></div>
                </div>
            </div>
        </div>
        <nav class="category-nav">
            <a href="best-deals.html" class="active"><i class=""></i> Best deals</a>
            <a href="#new-arrivals"><i class=""></i> New Arrivals</a>
            <a href="#wishlist"><i class="fas fa-heart"></i> Wishlist</a>
        </nav>
    </header>

    <div class="main-container">
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-login" id="sidebarLogin"></div>
            <div class="sidebar-search">
                <input type="text" placeholder="Search categories..." id="sidebarSearchInput">
            </div>
            <div class="sidebar-header">
                <h3>Browse Categories</h3>
                <button class="close-sidebar" onclick="closeSidebar()" aria-label="Close menu">&times;</button>
            </div>
              <div class="menu-content">
                <ul class="menu-items">
                    <li class="item">
                        <div class="submenu-item" onclick="toggleSubmenu(this)">
                            <span><i class=""></i> Cellphones & Tablets</span>
                            <i class="fa-solid fa-chevron-right"></i>
                        </div>
                        <ul class="menu-items submenu">
                            <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> Cellphones & Tablets</li>
                            <li class="item"><a href="smartphones.html">Smartphones</a></li>
                            <li class="item"><a href="#tablets">Tablets</a></li>
                            <li class="item"><a href="#phone-accessories">Accessories</a></li>
                        </ul>
                    </li>

                       <li class="item">
                         <div class="submenu-item" onclick="toggleSubmenu(this)">
                             <span><i class=""></i>Laptops</span>
                             <i class="fa-solid fa-chevron-right"></i>
                         </div>
                         <ul class="menu-items submenu">
                             <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> Laptops & Accessories</li>
                             <li class="item"><a href="#printers">Windows Laptops</a></li>
                             <li class="item"><a href="#monitors">Chromebooks</a></li>
                             <li class="item"><a href="#keyboards-mice">Macbooks</a></li>
                             <li class="item"><a href="#storage-devices">Gaming Laptops</a></li>
                             <li class="item"><a href="#computer-speakers">Accessories</a></li>
                        
                         </ul>
                    </li>


                    <li class="item">
                         <div class="submenu-item" onclick="toggleSubmenu(this)">
                             <span><i class=""></i> Computers & Accessories</span>
                             <i class="fa-solid fa-chevron-right"></i>
                         </div>
                         <ul class="menu-items submenu">
                             <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> Computers & Accessories</li>
                             <li class="item"><a href="#printers">Printers</a></li>
                             <li class="item"><a href="#monitors">Monitors</a></li>
                             <li class="item"><a href="#keyboards-mice">Keyboards & Mice</a></li>
                             <li class="item"><a href="#storage-devices">Storage Devices</a></li>
                             <li class="item"><a href="#computer-speakers">Computer Speakers</a></li>
                             <li class="item"><a href="#webcams">Webcams</a></li>
                         </ul>
                    </li>
                    <li class="item">
                        <div class="submenu-item" onclick="toggleSubmenu(this)">
                            <span><i class=""></i> TV & Streaming</span>
                            <i class="fa-solid fa-chevron-right"></i>
                        </div>
                        <ul class="menu-items submenu">
                            <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> TV & Streaming</li>
                            <li class="item"><a href="#televisions">Televisions</a></li>
                            <li class="item"><a href="#streaming-devices">Streaming Devices</a></li>
                            <li class="item"><a href="#tv-mounts">TV Mounts</a></li>
                            <li class="item"><a href="#remote-controls">Remote Controls</a></li>
                        </ul>
                    </li>

                       <li class="item">
                         <div class="submenu-item" onclick="toggleSubmenu(this)">
                             <span><i class=""></i>Audio</span>
                             <i class="fa-solid fa-chevron-right"></i>
                         </div>
                         <ul class="menu-items submenu">
                             <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> Audio</li>
                             <li class="item"><a href="#printers">Soundbars</a></li>
                             <li class="item"><a href="#monitors">Earbuds</a></li>
                             <li class="item"><a href="#keyboards-mice">Headphones</a></li>
                             <li class="item"><a href="#storage-devices">Bluetooth Speakers</a></li>
                             <li class="item"><a href="#computer-speakers">Home Audio Systems</a></li>
                        
                         </ul>
                    </li>

                         <li class="item">
                         <div class="submenu-item" onclick="toggleSubmenu(this)">
                             <span><i class=""></i>Wearables Devices</span>
                             <i class="fa-solid fa-chevron-right"></i>
                         </div>
                         <ul class="menu-items submenu">
                             <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> Wearables Devices</li>
                             <li class="item"><a href="#printers">Smartwatches</a></li>
                             <li class="item"><a href="#monitors">Fitness Trackers</a></li>
                             <li class="item"><a href="#keyboards-mice">VR Headsets</a></li>
                            
                         </ul>
                    </li>


                         <li class="item">
                         <div class="submenu-item" onclick="toggleSubmenu(this)">
                             <span><i class=""></i>Consoles</span>
                             <i class="fa-solid fa-chevron-right"></i>
                         </div>
                         <ul class="menu-items submenu">
                             <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> Consoles</li>
                             <li class="item"><a href="#printers">Consoles</a></li>
                             <li class="item"><a href="#monitors">Console Accessories</a></li>
                         </ul>
                    </li>
                       <li class="item">
                         <div class="submenu-item" onclick="toggleSubmenu(this)">
                             <span><i class=""></i> Appliances</span>
                             <i class="fa-solid fa-chevron-right"></i>
                         </div>
                         <ul class="menu-items submenu">
                             <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> Appliances</li>
                             <li class="item">
                                 <div class="submenu-item" onclick="toggleSubmenu(this)">
                                     <span>Kitchen Appliances</span>
                                     <i class="fa-solid fa-chevron-right"></i>
                                 </div>
                                 <ul class="menu-items submenu">
                                     <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> Kitchen Appliances</li>
                                     <li class="item"><a href="#refrigerators">Refrigerators</a></li>
                                     <li class="item"><a href="#microwaves">Microwaves</a></li>
                                     <li class="item"><a href="#coffee-machines">Coffee Machines</a></li>
                                     <li class="item"><a href="#blenders">Blenders</a></li>
                                 </ul>
                             </li>
                             <li class="item"><a href="#vacuum-cleaners">Vacuum Cleaners</a></li>
                             <li class="item"><a href="#air-conditioners">Air Conditioners</a></li>
                         </ul>
                    </li>
                </ul>
            </div>
            <div class="sidebar-footer">
                <div class="cookie-notice">
                    <p>This website uses cookies to provide you with the best experience.</p>
                    <button class="accept-cookies" onclick="acceptCookies()">Accept</button>
                </div>
            </div>
        </nav>
        <main class="content">
            <section class="hero-carousel">
                <div class="hero-slides">
                    <div class="hero-slide active">
                        <a href="https://www.takealot.com/black-friday" target="_blank" class="hero-slide-link">
                            <picture>
                                <source media="(max-width: 480px)" srcset="https://consumer.huawei.com/dam/content/dam/huawei-cbg-site/ecommerce/za/2025/June/MEGA/WAP-1080x1152.webp">
                                <source media="(max-width: 768px)" srcset="https://consumer.huawei.com/dam/content/dam/huawei-cbg-site/ecommerce/za/2025/June/MEGA/WAP-1080x1152.webp">
                                <img src="https://consumer.huawei.com/dam/content/dam/huawei-cbg-site/ecommerce/za/2025/June/MEGA/WEB--3840x1136.webp" alt="Black Friday Deals" class="hero-image">
                            </picture>
                        </a>
                    </div>
                    <div class="hero-slide">
                        <a href="https://www.amazon.com/prime-day" target="_blank" class="hero-slide-link">
                            <picture>
                                <source media="(max-width: 480px)" srcset="https://hisense.co.za/wp-content/uploads/2025/05/100KV_1920x800-1024x427.jpg">
                                <source media="(max-width: 768px)" srcset="https://www.asus.com/WebsitesBanner/ZA/banners/store/acizy7bp3pbajipj/acizy7bp3pbajipj-0_0_tablet_0_1X.jpg?webp">
                                <img src="https://www.defy.co.za/content/dam/defy/za/images-defy-homepage/desktop/Defy_Homepage_Desktop-Blog-Article-Hero-1.png/jcr:content/renditions/original" alt="Prime Day Deals" class="hero-image">
                            </picture>
                        </a>
                    </div>
                    <div class="hero-slide">
                         <a href="https://www.takealot.com/tech-deals" target="_blank" class="hero-slide-link">
                             <picture>
                                 <source media="(max-width: 480px)" srcset="https://www.asus.com/WebsitesBanner/ZA/banners/store/acizy7bp3pbajipj/acizy7bp3pbajipj-0_0_mobile_0_1X.jpg?webp">
                                 <source media="(max-width: 768px)" srcset="https://www.asus.com/WebsitesBanner/ZA/banners/store/acizy7bp3pbajipj/acizy7bp3pbajipj-0_0_tablet_0_1X.jpg?webp">
                                 <img src="https://www.asus.com/WebsitesBanner/ZA/banners/store/acizy7bp3pbajipj/acizy7bp3pbajipj-0_0_desktop_0_1X.jpg?webp" alt="Tech Deals" class="hero-image">
                             </picture>
                         </a>
                    </div>
                    <div class="hero-slide">
                         <a href="https://www.amazon.com/home-appliances" target="_blank" class="hero-slide-link">
                             <picture>
                                 <source media="(max-width: 480px)" srcset="https://www.asus.com/WebsitesBanner/ZA/banners/store/mh69pfka5ufjjdyj/mh69pfka5ufjjdyj-0_0_mobile_0_1X.jpg">
                                 <source media="(max-width: 768px)" srcset="https://www.asus.com/WebsitesBanner/ZA/banners/store/mh69pfka5ufjjdyj/mh69pfka5ufjjdyj-0_0_tablet_0_1X.jpg">
                                 <img src="https://www.asus.com/WebsitesBanner/ZA/banners/store/mh69pfka5ufjjdyj/mh69pfka5ufjjdyj-0_0_desktop_0_1X.jpg" alt="Home Appliances Sale" class="hero-image">
                             </picture>
                         </a>
                    </div>
                </div>
                <div class="hero-indicators">
                    <span class="hero-indicator active" data-slide="0"></span>
                    <span class="hero-indicator" data-slide="1"></span>
                    <span class="hero-indicator" data-slide="2"></span>
                    <span class="hero-indicator" data-slide="3"></span>
                </div>
            </section>
            <section class="deals-section">
                <div class="section-header">
                    <h2 class="section-title"> Today's Best Deals On 
                        <img src="https://www.takealot.com/2cbdc3190194b57fa66049c9cd37d68bc3716afa/static/media/src/images/logo.svg-f6ccb4bbddf97d6.svg" alt="Takealot" class="store-logo">
                    </h2>
                </div>
                <div class="products-carousel" id="takealotCarousel">
                    <div class="products-slider" id="takealotSlider"></div>
                </div>
                <div class="carousel-indicators" id="takealotIndicators"></div>
            </section>
            <section class="deals-section">
                <div class="section-header">
                    <h2 class="section-title">
                        Today's Best Deals On 
                        <img src="https://static.vecteezy.com/system/resources/previews/012/681/601/non_2x/amazon-logotypetion-popular-online-shoping-icon-free-png.png" alt="Amazon" class="store-logo">
                    </h2>
                </div>
                <div class="products-carousel" id="amazonCarousel">
                    <div class="products-slider" id="amazonSlider"></div>
                </div>
                <div class="carousel-indicators" id="amazonIndicators"></div>
            </section>
        </main>
    </div>

    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>About CompareHubPrices</h3>
                <ul>
                    <li><a href="#about">About Us</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Help & Support</h3>
                <ul>
                    <li><a href="#contact">Contact Us</a></li>
                    <li><a href="#faq">FAQs</a></li>
                    <li><a href="#privacy">Privacy Policy</a></li>
                    <li><a href="#terms">Terms of Service</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Connect With Us</h3>
                <div class="social-icons">
                    <a href="#" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
                    <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                </div>
                <div class="newsletter-section">
                    <h4>Get the Best Deals in Your Inbox</h4>
                    <form class="newsletter-form" onsubmit="subscribeNewsletter(event)">
                        <input type="email" placeholder="Enter your email address" required aria-label="Email address for newsletter">
                        <button type="submit"><i class="fas fa-paper-plane"></i> Subscribe</button>
                    </form>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 CompareHub Prices. All rights reserved.</p>
        </div>
    </footer>

<script>
document.addEventListener('DOMContentLoaded', function() {

    // --- CORE INITIALIZATION ---
    // This is the main function that runs when the page is loaded.
    function initializePage() {
        setupEventListeners();
        updateUserLoginStatus(); // Check if user is logged in
        fetchDealsData(); // Fetch product deals
    }

    // --- AUTHENTICATION & USER STATUS ---

    // This function checks for a login token and updates the sidebar accordingly.
    async function updateUserLoginStatus() {
        const sidebarLogin = document.getElementById('sidebarLogin');
        if (!sidebarLogin) return; // Exit if the login element doesn't exist

        const accessToken = localStorage.getItem('accessToken');

        // Display the logged-out view (login button)
        const showLoggedOutState = () => {
            sidebarLogin.innerHTML = `
                <a href="login.html" class="login-btn">
                    <i class="fas fa-sign-in-alt"></i>Login to CompareHub
                </a>
            `;
        };

        if (!accessToken) {
            showLoggedOutState();
            return;
        }

        // If a token exists, call the userinfo API to validate it
        const userInfoApiUrl = 'https://w1yg1wc8cf.execute-api.af-south-1.amazonaws.com/prod/userinfo';
        try {
            const response = await fetch(userInfoApiUrl, {
                method: 'POST',
                headers: { 'Authorization': `Bearer ${accessToken}` }
            });

            if (!response.ok) {
                // If the response is not OK, parse the error message from the body
                const errorData = await response.json().catch(() => ({ error: 'Invalid session or API error' }));
                throw new Error(errorData.error);
            }

            const data = await response.json();
            const user = data.user;

            // If everything is successful, display the logged-in view
            const username = user.Username;
            const emailAttribute = user.UserAttributes.find(attr => attr.Name === 'email');
            const email = emailAttribute ? emailAttribute.Value : 'No email found';

            sidebarLogin.innerHTML = `
                <div class="user-greeting fade-in">
                    <div class="user-avatar" style="cursor:pointer;" onclick="window.location.href='profile.html'">
                        ${getInitials(username)}
                    </div>
                    <div class="user-info">
                        <div class="user-name">${username}</div>
                        <div class="user-email">${email}</div>
                        <span class="sign-out" style="cursor:pointer;">Sign Out</span>
                    </div>
                </div>
            `;

            // Add the sign-out functionality
            const signOutEl = sidebarLogin.querySelector('.sign-out');
            if (signOutEl) {
                signOutEl.addEventListener('click', (event) => {
                    event.stopPropagation();
                    localStorage.removeItem('accessToken');
                    window.location.reload();
                });
            }

        } catch (error) {
            console.error("Authentication check failed:", error.message);
            // If any error occurs, clear the bad token and show the logged-out state
            localStorage.removeItem('accessToken');
            showLoggedOutState();
        }
    }

    // Helper function to get user initials for the avatar
    function getInitials(str) {
        if (!str) return "";
        let [name] = str.split('@');
        let parts = name.split(/[.\-_]/);
        if (parts.length > 1 && parts[0] && parts[1]) {
            return (parts[0][0] + parts[1][0]).toUpperCase();
        }
        return name ? name[0].toUpperCase() : '';
    }

    // --- EVENT LISTENERS & UI SETUP ---
    function setupEventListeners() {
        // Fixed Header Padding
        setBodyPadding();
        window.addEventListener('resize', setBodyPadding);

        // Sidebar Toggles
        const sidebarToggle = document.querySelector('.sidebar-toggle');
        if (sidebarToggle) sidebarToggle.addEventListener('click', toggleSidebar);

        const closeSidebarBtn = document.querySelector('.close-sidebar');
        if (closeSidebarBtn) closeSidebarBtn.addEventListener('click', closeSidebar);
        
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        if(sidebarOverlay) sidebarOverlay.addEventListener('click', closeSidebar);

        // Sidebar Sub-menus
        document.querySelectorAll('.submenu-item').forEach(item => {
            item.addEventListener('click', () => toggleSubmenu(item));
        });
        document.querySelectorAll('.menu-title').forEach(item => {
            item.addEventListener('click', () => goBack(item));
        });
        
        // Search
        const searchForm = document.getElementById('search-form');
        if (searchForm) searchForm.addEventListener('submit', performSearch);
        
        const searchInput = document.getElementById('searchInput');
        if (searchInput) searchInput.addEventListener('input', handleSearchInput);

        // Other Event Listeners can be added here
    }

    // --- SIDEBAR & NAVIGATION FUNCTIONS ---
    function setBodyPadding() { /* Your existing setBodyPadding code */ }
    function toggleSidebar() { /* Your existing toggleSidebar code */ }
    function closeSidebar() { /* Your existing closeSidebar code */ }
    function toggleSubmenu(element) { /* Your existing toggleSubmenu code */ }
    function goBack(element) { /* Your existing goBack code */ }

    // --- SEARCH FUNCTIONS ---
    function performSearch(event) { /* Your existing performSearch code */ }
    function handleSearchInput(e) { /* Your existing search input/suggestions code */ }
    window.selectSuggestion = function(suggestion) { /* Your existing selectSuggestion code */ };

    // --- DEALS & CAROUSEL FUNCTIONS ---
    async function fetchDealsData() { /* Your existing fetchDealsData code */ }
    function processDealsData(data) { /* Your existing processDealsData code */ }
    function createSlidesFromProducts(products, productsPerSlide) { /* Your existing createSlidesFromProducts code */ }
    function showLoadingState() { /* Your existing showLoadingState code */ }
    function hideLoadingState() { /* Your existing hideLoadingState code */ }
    function showErrorState(errorMessage) { /* Your existing showErrorState code */ }
    function createProductCard(product) { /* Your existing createProductCard code */ return `...`; }
    function initializeProductCarousel(store, slidesData) { /* Your existing carousel initialization code */ }
    
    // --- HERO CAROUSEL FUNCTIONS ---
    function setupHeroCarousel() { /* Your existing hero carousel code */ }


    // --- KICK OFF THE PAGE ---
    initializePage();

});
</script>


</body>
</html>
