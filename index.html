<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homepage - CompareHub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="hero-carousel-animations.css">
    <link rel="stylesheet" href="index.css">
    <style>
        @media screen and (min-width: 992px) {
            .search-container {
                width: 75%;
                max-width: 1000px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-top">
            <button class="sidebar-toggle" onclick="toggleSidebar()" aria-label="Open menu">â˜°</button>
            <div class="logo">
                <a href="index.html" class="logo-link">
                    <img src="https://comparehub-smartphone-images.s3.af-south-1.amazonaws.com/IMG_20250625_174144.jpg" alt="CompareHubPrices" class="logo-image">
                </a>
            </div>
            <div class="search-container">
                <form id="search-form" onsubmit="performSearch(event)">
                    <input type="text" name="q" class="search-input" placeholder="Search......." id="searchInput">
                    <button type="submit" class="search-button" aria-label="Search"><i class="fas fa-search"></i></button>
                </form>
                <div class="search-suggestions" id="searchSuggestions">
                    <div class="suggestions-header">
                        <span class="all-results">All</span>
                        <span class="search-query" id="searchQuery">results</span>
                    </div>
                    <div class="suggestions-grid" id="suggestionsGrid"></div>
                </div>
            </div>
        </div>
        <nav class="category-nav">
            <a href="best-deals.html" class="active"><i class=""></i> Best deals</a>
            <a href="#new-arrivals"><i class=""></i> New Arrivals</a>
            <a href="#wishlist"><i class="fas fa-heart"></i> Wishlist</a>
        </nav>
    </header>

    <div class="main-container">
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-login" id="sidebarLogin"></div>
            <div class="sidebar-search">
                <input type="text" placeholder="Search categories..." id="sidebarSearchInput">
            </div>
            <div class="sidebar-header">
                <h3>Browse Categories</h3>
                <button class="close-sidebar" onclick="closeSidebar()" aria-label="Close menu">&times;</button>
            </div>
              <div class="menu-content">
                <ul class="menu-items">
                    <li class="item">
                        <div class="submenu-item" onclick="toggleSubmenu(this)">
                            <span><i class=""></i> Cellphones & Tablets</span>
                            <i class="fa-solid fa-chevron-right"></i>
                        </div>
                        <ul class="menu-items submenu">
                            <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> Cellphones & Tablets</li>
                            <li class="item"><a href="smartphones.html">Smartphones</a></li>
                            <li class="item"><a href="#tablets">Tablets</a></li>
                            <li class="item"><a href="#phone-accessories">Accessories</a></li>
                        </ul>
                    </li>

                       <li class="item">
                         <div class="submenu-item" onclick="toggleSubmenu(this)">
                             <span><i class=""></i>Laptops</span>
                             <i class="fa-solid fa-chevron-right"></i>
                         </div>
                         <ul class="menu-items submenu">
                             <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> Laptops & Accessories</li>
                             <li class="item"><a href="#printers">Windows Laptops</a></li>
                             <li class="item"><a href="#monitors">Chromebooks</a></li>
                             <li class="item"><a href="#keyboards-mice">Macbooks</a></li>
                             <li class="item"><a href="#storage-devices">Gaming Laptops</a></li>
                             <li class="item"><a href="#computer-speakers">Accessories</a></li>
                        
                         </ul>
                    </li>


                    <li class="item">
                         <div class="submenu-item" onclick="toggleSubmenu(this)">
                             <span><i class=""></i> Computers & Accessories</span>
                             <i class="fa-solid fa-chevron-right"></i>
                         </div>
                         <ul class="menu-items submenu">
                             <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> Computers & Accessories</li>
                             <li class="item"><a href="#printers">Printers</a></li>
                             <li class="item"><a href="#monitors">Monitors</a></li>
                             <li class="item"><a href="#keyboards-mice">Keyboards & Mice</a></li>
                             <li class="item"><a href="#storage-devices">Storage Devices</a></li>
                             <li class="item"><a href="#computer-speakers">Computer Speakers</a></li>
                             <li class="item"><a href="#webcams">Webcams</a></li>
                         </ul>
                    </li>
                    <li class="item">
                        <div class="submenu-item" onclick="toggleSubmenu(this)">
                            <span><i class=""></i> TV & Streaming</span>
                            <i class="fa-solid fa-chevron-right"></i>
                        </div>
                        <ul class="menu-items submenu">
                            <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> TV & Streaming</li>
                            <li class="item"><a href="#televisions">Televisions</a></li>
                            <li class="item"><a href="#streaming-devices">Streaming Devices</a></li>
                            <li class="item"><a href="#tv-mounts">TV Mounts</a></li>
                            <li class="item"><a href="#remote-controls">Remote Controls</a></li>
                        </ul>
                    </li>

                       <li class="item">
                         <div class="submenu-item" onclick="toggleSubmenu(this)">
                             <span><i class=""></i>Audio</span>
                             <i class="fa-solid fa-chevron-right"></i>
                         </div>
                         <ul class="menu-items submenu">
                             <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> Audio</li>
                             <li class="item"><a href="#printers">Soundbars</a></li>
                             <li class="item"><a href="#monitors">Earbuds</a></li>
                             <li class="item"><a href="#keyboards-mice">Headphones</a></li>
                             <li class="item"><a href="#storage-devices">Bluetooth Speakers</a></li>
                             <li class="item"><a href="#computer-speakers">Home Audio Systems</a></li>
                        
                         </ul>
                    </li>

                         <li class="item">
                         <div class="submenu-item" onclick="toggleSubmenu(this)">
                             <span><i class=""></i>Wearables Devices</span>
                             <i class="fa-solid fa-chevron-right"></i>
                         </div>
                         <ul class="menu-items submenu">
                             <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> Wearables Devices</li>
                             <li class="item"><a href="#printers">Smartwatches</a></li>
                             <li class="item"><a href="#monitors">Fitness Trackers</a></li>
                             <li class="item"><a href="#keyboards-mice">VR Headsets</a></li>
                            
                         </ul>
                    </li>


                         <li class="item">
                         <div class="submenu-item" onclick="toggleSubmenu(this)">
                             <span><i class=""></i>Consoles</span>
                             <i class="fa-solid fa-chevron-right"></i>
                         </div>
                         <ul class="menu-items submenu">
                             <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> Consoles</li>
                             <li class="item"><a href="#printers">Consoles</a></li>
                             <li class="item"><a href="#monitors">Console Accessories</a></li>
                         </ul>
                    </li>
                       <li class="item">
                         <div class="submenu-item" onclick="toggleSubmenu(this)">
                             <span><i class=""></i> Appliances</span>
                             <i class="fa-solid fa-chevron-right"></i>
                         </div>
                         <ul class="menu-items submenu">
                             <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> Appliances</li>
                             <li class="item">
                                 <div class="submenu-item" onclick="toggleSubmenu(this)">
                                     <span>Kitchen Appliances</span>
                                     <i class="fa-solid fa-chevron-right"></i>
                                 </div>
                                 <ul class="menu-items submenu">
                                     <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> Kitchen Appliances</li>
                                     <li class="item"><a href="#refrigerators">Refrigerators</a></li>
                                     <li class="item"><a href="#microwaves">Microwaves</a></li>
                                     <li class="item"><a href="#coffee-machines">Coffee Machines</a></li>
                                     <li class="item"><a href="#blenders">Blenders</a></li>
                                 </ul>
                             </li>
                             <li class="item"><a href="#vacuum-cleaners">Vacuum Cleaners</a></li>
                             <li class="item"><a href="#air-conditioners">Air Conditioners</a></li>
                         </ul>
                    </li>
                </ul>
            </div>
            <div class="sidebar-footer">
                <div class="cookie-notice">
                    <p>This website uses cookies to provide you with the best experience.</p>
                    <button class="accept-cookies" onclick="acceptCookies()">Accept</button>
                </div>
            </div>
        </nav>
        <main class="content">
            <section class="hero-carousel">
                <div class="hero-slides">
                    <div class="hero-slide active">
                        <a href="https://www.takealot.com/black-friday" target="_blank" class="hero-slide-link">
                            <picture>
                                <source media="(max-width: 480px)" srcset="https://consumer.huawei.com/dam/content/dam/huawei-cbg-site/ecommerce/za/2025/June/MEGA/WAP-1080x1152.webp">
                                <source media="(max-width: 768px)" srcset="https://consumer.huawei.com/dam/content/dam/huawei-cbg-site/ecommerce/za/2025/June/MEGA/WAP-1080x1152.webp">
                                <img src="https://consumer.huawei.com/dam/content/dam/huawei-cbg-site/ecommerce/za/2025/June/MEGA/WEB--3840x1136.webp" alt="Black Friday Deals" class="hero-image">
                            </picture>
                        </a>
                    </div>
                    <div class="hero-slide">
                        <a href="https://www.amazon.com/prime-day" target="_blank" class="hero-slide-link">
                            <picture>
                                <source media="(max-width: 480px)" srcset="https://hisense.co.za/wp-content/uploads/2025/05/100KV_1920x800-1024x427.jpg">
                                <source media="(max-width: 768px)" srcset="https://www.asus.com/WebsitesBanner/ZA/banners/store/acizy7bp3pbajipj/acizy7bp3pbajipj-0_0_tablet_0_1X.jpg?webp">
                                <img src="https://www.defy.co.za/content/dam/defy/za/images-defy-homepage/desktop/Defy_Homepage_Desktop-Blog-Article-Hero-1.png/jcr:content/renditions/original" alt="Prime Day Deals" class="hero-image">
                            </picture>
                        </a>
                    </div>
                    <div class="hero-slide">
                         <a href="https://www.takealot.com/tech-deals" target="_blank" class="hero-slide-link">
                             <picture>
                                 <source media="(max-width: 480px)" srcset="https://www.asus.com/WebsitesBanner/ZA/banners/store/acizy7bp3pbajipj/acizy7bp3pbajipj-0_0_mobile_0_1X.jpg?webp">
                                 <source media="(max-width: 768px)" srcset="https://www.asus.com/WebsitesBanner/ZA/banners/store/acizy7bp3pbajipj/acizy7bp3pbajipj-0_0_tablet_0_1X.jpg?webp">
                                 <img src="https://www.asus.com/WebsitesBanner/ZA/banners/store/acizy7bp3pbajipj/acizy7bp3pbajipj-0_0_desktop_0_1X.jpg?webp" alt="Tech Deals" class="hero-image">
                             </picture>
                         </a>
                    </div>
                    <div class="hero-slide">
                         <a href="https://www.amazon.com/home-appliances" target="_blank" class="hero-slide-link">
                             <picture>
                                 <source media="(max-width: 480px)" srcset="https://www.asus.com/WebsitesBanner/ZA/banners/store/mh69pfka5ufjjdyj/mh69pfka5ufjjdyj-0_0_mobile_0_1X.jpg">
                                 <source media="(max-width: 768px)" srcset="https://www.asus.com/WebsitesBanner/ZA/banners/store/mh69pfka5ufjjdyj/mh69pfka5ufjjdyj-0_0_tablet_0_1X.jpg">
                                 <img src="https://www.asus.com/WebsitesBanner/ZA/banners/store/mh69pfka5ufjjdyj/mh69pfka5ufjjdyj-0_0_desktop_0_1X.jpg" alt="Home Appliances Sale" class="hero-image">
                             </picture>
                         </a>
                    </div>
                </div>
                <div class="hero-indicators">
                    <span class="hero-indicator active" data-slide="0"></span>
                    <span class="hero-indicator" data-slide="1"></span>
                    <span class="hero-indicator" data-slide="2"></span>
                    <span class="hero-indicator" data-slide="3"></span>
                </div>
            </section>
            <section class="deals-section">
                <div class="section-header">
                    <h2 class="section-title"> Today's Best Deals On 
                        <img src="https://www.takealot.com/2cbdc3190194b57fa66049c9cd37d68bc3716afa/static/media/src/images/logo.svg-f6ccb4bbddf97d6.svg" alt="Takealot" class="store-logo">
                    </h2>
                </div>
                <div class="products-carousel" id="takealotCarousel">
                    <div class="products-slider" id="takealotSlider"></div>
                </div>
                <div class="carousel-indicators" id="takealotIndicators"></div>
            </section>
            <section class="deals-section">
                <div class="section-header">
                    <h2 class="section-title">
                        Today's Best Deals On 
                        <img src="https://static.vecteezy.com/system/resources/previews/012/681/601/non_2x/amazon-logotypetion-popular-online-shoping-icon-free-png.png" alt="Amazon" class="store-logo">
                    </h2>
                </div>
                <div class="products-carousel" id="amazonCarousel">
                    <div class="products-slider" id="amazonSlider"></div>
                </div>
                <div class="carousel-indicators" id="amazonIndicators"></div>
            </section>
        </main>
    </div>

    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>About CompareHubPrices</h3>
                <ul>
                    <li><a href="#about">About Us</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Help & Support</h3>
                <ul>
                    <li><a href="#contact">Contact Us</a></li>
                    <li><a href="#faq">FAQs</a></li>
                    <li><a href="#privacy">Privacy Policy</a></li>
                    <li><a href="#terms">Terms of Service</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Connect With Us</h3>
                <div class="social-icons">
                    <a href="#" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
                    <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                </div>
                <div class="newsletter-section">
                    <h4>Get the Best Deals in Your Inbox</h4>
                    <form class="newsletter-form" onsubmit="subscribeNewsletter(event)">
                        <input type="email" placeholder="Enter your email address" required aria-label="Email address for newsletter">
                        <button type="submit"><i class="fas fa-paper-plane"></i> Subscribe</button>
                    </form>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 CompareHub Prices. All rights reserved.</p>
        </div>
    </footer>

<script>
document.addEventListener('DOMContentLoaded', async function() {
    // Dynamic body padding for fixed header
    function setBodyPadding() {
        const header = document.querySelector('.header');
        if (header) {
            const headerHeight = header.offsetHeight;
            document.body.style.paddingTop = `${headerHeight}px`;
        }
    }
    setBodyPadding();
    window.addEventListener('resize', setBodyPadding);

    const API_URL = 'https://xf9zlapr5e.execute-api.af-south-1.amazonaws.com/deals';
    // This correctly points to your new custom domain
    const AUTH_API_URL = "https://api.comparehubprices.site";


    // ---------- USER INFO HELPERS (Unchanged) ----------
    function getAttribute(userInfo, attrName) {
        const attrs = userInfo.Attributes || userInfo.UserAttributes || [];
        if (Array.isArray(attrs)) {
            const found = attrs.find(attr => attr.Name === attrName);
            if (found) return found.Value;
        }
        if (userInfo[attrName]) return userInfo[attrName];
        if (attrName === 'picture' && userInfo.avatar) return userInfo.avatar;
        if (attrName === 'picture' && userInfo.picture) return userInfo.picture;
        return '';
    }

    function getDisplayName(userInfo) {
        if (userInfo.name) return userInfo.name;
        if (userInfo.displayName) return userInfo.displayName;
        if (userInfo.email) return userInfo.email.split('@')[0].replace(/[.\-_]/g, ' ').replace(/(^|\s)\S/g, l => l.toUpperCase());
        return userInfo.userId || userInfo.Username || '';
    }

    function getAvatarInitials(userInfo) {
        if (userInfo.avatar || userInfo.picture) return "";
        const displayName = getDisplayName(userInfo);
        if (displayName) {
            const parts = displayName.split(' ');
            if (parts.length >= 2) return (parts[0][0] + parts[1][0]).toUpperCase();
            return displayName[0].toUpperCase();
        }
        return 'U';
    }


    // ---------- SIDEBAR LOGIN (FINAL VERSION) ----------

    // Checks the user's login status.
    async function handleUserSession() {
        try {
            // FINAL CHANGE: The method is now GET.
            const resp = await fetch(`${AUTH_API_URL}/userinfo`, {
                method: "GET",
                credentials: "include"
            });

            if (resp.ok) {
                const data = await resp.json();
                renderLoggedInView(data.user);
            } else {
                renderLoggedOutView();
            }
        } catch (error) {
            console.error("Could not fetch user session:", error);
            renderLoggedOutView();
        }
    }
    
    // Handles logout. Changed to GET for consistency.
    async function handleLogout(event) {
        event.preventDefault();
        event.stopPropagation();
        
        const sidebarLogin = document.getElementById('sidebarLogin');
        if(sidebarLogin) sidebarLogin.innerHTML = 'Signing out...';

        try {
            await fetch(`${AUTH_API_URL}/logout`, {
                method: "GET", // Using GET for consistency
                credentials: "include"
            });
        } catch (error) {
            console.error("Logout failed:", error);
        } finally {
            window.location.href = "index.html";
        }
    }

    // Renders the logged-out view.
    function renderLoggedOutView() {
        const sidebarLogin = document.getElementById('sidebarLogin');
        if (!sidebarLogin) return;
        sidebarLogin.innerHTML = `
            <a href="login.html" class="login-btn">
                <i class="fas fa-sign-in-alt"></i>Login to CompareHub
            </a>
        `;
    }

    // Renders the logged-in view.
    function renderLoggedInView(userInfo) {
        const sidebarLogin = document.getElementById('sidebarLogin');
        if (!sidebarLogin) return;

        const name = getDisplayName(userInfo);
        const email = getAttribute(userInfo, 'email');
        const avatar = getAttribute(userInfo, 'picture');
        const initials = getAvatarInitials(userInfo);

        sidebarLogin.innerHTML = `
            <div class="user-greeting fade-in">
                <div class="user-avatar" style="cursor:pointer;">
                    ${avatar ? `<img src="${avatar}" alt="Avatar">` : initials}
                </div>
                <div class="user-info">
                    <div class="user-name">${name}</div>
                    <div class="user-email">${email || ''}</div>
                    <span class="sign-out" style="cursor:pointer;">Sign Out</span>
                </div>
            </div>
        `;
        const avatarEl = sidebarLogin.querySelector('.user-avatar');
        if (avatarEl) avatarEl.addEventListener('click', function(event) {
            event.preventDefault();
            event.stopPropagation();
            window.location.href = "profile.html";
        });
        
        const signOutEl = sidebarLogin.querySelector('.sign-out');
        if (signOutEl) signOutEl.addEventListener('click', handleLogout);
    }
    

    // --- ALL OTHER FUNCTIONS BELOW ARE UNCHANGED ---

    // ---------- HERO CAROUSEL ----------
    const heroCarousel = document.querySelector('.hero-carousel');
    if (heroCarousel) {
        const heroSlides = heroCarousel.querySelectorAll('.hero-slide');
        const heroIndicators = heroCarousel.querySelectorAll('.hero-indicator');
        let currentIndex = 0; let interval; let touchStartX = 0; const slideDuration = 10000;
        function showSlide(index) {
            heroSlides.forEach((slide, i) => slide.classList.toggle('active', i === index));
            heroIndicators.forEach((indicator, i) => indicator.classList.toggle('active', i === index));
            currentIndex = index;
        }
        function nextSlide() { showSlide((currentIndex + 1) % heroSlides.length); }
        function prevSlide() { showSlide((currentIndex - 1 + heroSlides.length) % heroSlides.length); }
        function startCarousel() { stopCarousel(); interval = setInterval(nextSlide, slideDuration); }
        function stopCarousel() { clearInterval(interval); }
        if (heroSlides.length > 0) {
            showSlide(0); startCarousel();
            heroIndicators.forEach((indicator, index) => indicator.addEventListener('click', () => { stopCarousel(); showSlide(index); startCarousel(); }));
            heroCarousel.addEventListener('touchstart', (e) => { touchStartX = e.touches[0].clientX; stopCarousel(); });
            heroCarousel.addEventListener('touchend', (e) => {
                const diff = e.changedTouches[0].clientX - touchStartX;
                if (Math.abs(diff) > 50) { if (diff > 0) prevSlide(); else nextSlide(); }
                startCarousel();
            });
            heroCarousel.addEventListener('mouseenter', stopCarousel);
            heroCarousel.addEventListener('mouseleave', startCarousel);
            document.addEventListener('keydown', (e) => { if (e.key === 'ArrowRight') nextSlide(); else if (e.key === 'ArrowLeft') prevSlide(); });
        }
    }

    // ---------- FETCH DEALS DATA ----------
    async function fetchDealsData() {
        try {
            showLoadingState();
            const response = await fetch(API_URL, { method: 'GET', headers: {'Content-Type': 'application/json'} });
            if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
            const data = await response.json();
            processDealsData(data);
            hideLoadingState();
        } catch (error) { showErrorState(error.message); }
    }
    function processDealsData(data) {
        const createSlides = (products, perSlide) => {
            const slides = [];
            for (let i = 0; i < products.length; i += perSlide) { slides.push(products.slice(i, i + perSlide)); }
            return slides;
        };
        if (data.takealot) initializeProductCarousel('takealot', createSlides(data.takealot, 5));
        if (data.amazon) initializeProductCarousel('amazon', createSlides(data.amazon, 5));
    }
    function showLoadingState() { /*...*/ }
    function hideLoadingState() { /*...*/ }
    function showErrorState(errorMessage) { /*...*/ }

    // ---------- PRODUCT CARD & CAROUSEL ----------
    function createProductCard(product) { /*...*/ }
    function initializeProductCarousel(store, slidesData) { /*...*/ }
    function showProductSlide(store, index) { /*...*/ }
    function setupProductCarousel(store, totalSlides) { /*...*/ }

    // ---------- SEARCH ----------
    window.performSearch = function(event) { /*...*/ };
    document.getElementById('searchInput').addEventListener('input', function(e) { /*...*/ });
    window.selectSuggestion = function(suggestion) { /*...*/ };
    document.addEventListener('click', function(e) { /*...*/ });

    // ---------- SIDEBAR ----------
    window.toggleSidebar = function() { /*...*/ };
    window.closeSidebar = function() { /*...*/ };
    window.toggleSubmenu = function(element) { /*...*/ };
    window.goBack = function(element) { /*...*/ };
    document.getElementById('sidebarSearchInput').addEventListener('input', function(e) { /*...*/ });
    document.addEventListener('click', function(e) { /*...*/ });

    // ---------- FOOTER ACTIONS ----------
    window.acceptCookies = function() { /*...*/ };
    window.subscribeNewsletter = function(event) { /*...*/ };
    
    // --- INITIALIZE PAGE ---
    await handleUserSession();
    fetchDealsData();
});
</script>
</body>
</html>
