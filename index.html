<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Homepage - CompareHub</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <link rel="stylesheet" href="hero-carousel-animations.css">
    <link rel="stylesheet" href="index.css">
    <style>
        @media screen and (min-width: 992px) {
            .search-container {
                width: 75%;
                max-width: 1000px;
            }
        }
    </style>
</head>
<body>
    <header class="header">
        <div class="header-top">
            <button class="sidebar-toggle" onclick="toggleSidebar()" aria-label="Open menu">â˜°</button>
            <div class="logo">
                <a href="index.html" class="logo-link">
                    <img src="https://comparehub-smartphone-images.s3.af-south-1.amazonaws.com/IMG_20250625_174144.jpg" alt="CompareHubPrices" class="logo-image">
                </a>
            </div>
            <div class="search-container">
                <form id="search-form" onsubmit="performSearch(event)">
                    <input type="text" name="q" class="search-input" placeholder="Search......." id="searchInput">
                    <button type="submit" class="search-button" aria-label="Search"><i class="fas fa-search"></i></button>
                </form>
                <div class="search-suggestions" id="searchSuggestions">
                    <div class="suggestions-header">
                        <span class="all-results">All</span>
                        <span class="search-query" id="searchQuery">results</span>
                    </div>
                    <div class="suggestions-grid" id="suggestionsGrid"></div>
                </div>
            </div>
        </div>
        <nav class="category-nav">
            <a href="best-deals.html" class="active"><i class=""></i> Best deals</a>
            <a href="#new-arrivals"><i class=""></i> New Arrivals</a>
            <a href="#wishlist"><i class="fas fa-heart"></i> Wishlist</a>
        </nav>
    </header>

    <div class="main-container">
        <nav class="sidebar" id="sidebar">
            <div class="sidebar-login" id="sidebarLogin"></div>
            <div class="sidebar-search">
                <input type="text" placeholder="Search categories..." id="sidebarSearchInput">
            </div>
            <div class="sidebar-header">
                <h3>Browse Categories</h3>
                <button class="close-sidebar" onclick="closeSidebar()" aria-label="Close menu">&times;</button>
            </div>
              <div class="menu-content">
                <ul class="menu-items">
                    <li class="item">
                        <div class="submenu-item" onclick="toggleSubmenu(this)">
                            <span><i class=""></i> Cellphones & Tablets</span>
                            <i class="fa-solid fa-chevron-right"></i>
                        </div>
                        <ul class="menu-items submenu">
                            <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> Cellphones & Tablets</li>
                            <li class="item"><a href="smartphones.html">Smartphones</a></li>
                            <li class="item"><a href="#tablets">Tablets</a></li>
                            <li class="item"><a href="#phone-accessories">Accessories</a></li>
                        </ul>
                    </li>

                       <li class="item">
                         <div class="submenu-item" onclick="toggleSubmenu(this)">
                             <span><i class=""></i>Laptops</span>
                             <i class="fa-solid fa-chevron-right"></i>
                         </div>
                         <ul class="menu-items submenu">
                             <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> Laptops & Accessories</li>
                             <li class="item"><a href="#printers">Windows Laptops</a></li>
                             <li class="item"><a href="#monitors">Chromebooks</a></li>
                             <li class="item"><a href="#keyboards-mice">Macbooks</a></li>
                             <li class="item"><a href="#storage-devices">Gaming Laptops</a></li>
                             <li class="item"><a href="#computer-speakers">Accessories</a></li>
                        
                         </ul>
                    </li>


                    <li class="item">
                         <div class="submenu-item" onclick="toggleSubmenu(this)">
                             <span><i class=""></i> Computers & Accessories</span>
                             <i class="fa-solid fa-chevron-right"></i>
                         </div>
                         <ul class="menu-items submenu">
                             <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> Computers & Accessories</li>
                             <li class="item"><a href="#printers">Printers</a></li>
                             <li class="item"><a href="#monitors">Monitors</a></li>
                             <li class="item"><a href="#keyboards-mice">Keyboards & Mice</a></li>
                             <li class="item"><a href="#storage-devices">Storage Devices</a></li>
                             <li class="item"><a href="#computer-speakers">Computer Speakers</a></li>
                             <li class="item"><a href="#webcams">Webcams</a></li>
                         </ul>
                    </li>
                    <li class="item">
                        <div class="submenu-item" onclick="toggleSubmenu(this)">
                            <span><i class=""></i> TV & Streaming</span>
                            <i class="fa-solid fa-chevron-right"></i>
                        </div>
                        <ul class="menu-items submenu">
                            <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> TV & Streaming</li>
                            <li class="item"><a href="#televisions">Televisions</a></li>
                            <li class="item"><a href="#streaming-devices">Streaming Devices</a></li>
                            <li class="item"><a href="#tv-mounts">TV Mounts</a></li>
                            <li class="item"><a href="#remote-controls">Remote Controls</a></li>
                        </ul>
                    </li>

                       <li class="item">
                         <div class="submenu-item" onclick="toggleSubmenu(this)">
                             <span><i class=""></i>Audio</span>
                             <i class="fa-solid fa-chevron-right"></i>
                         </div>
                         <ul class="menu-items submenu">
                             <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> Audio</li>
                             <li class="item"><a href="#printers">Soundbars</a></li>
                             <li class="item"><a href="#monitors">Earbuds</a></li>
                             <li class="item"><a href="#keyboards-mice">Headphones</a></li>
                             <li class="item"><a href="#storage-devices">Bluetooth Speakers</a></li>
                             <li class="item"><a href="#computer-speakers">Home Audio Systems</a></li>
                        
                         </ul>
                    </li>

                         <li class="item">
                         <div class="submenu-item" onclick="toggleSubmenu(this)">
                             <span><i class=""></i>Wearables Devices</span>
                             <i class="fa-solid fa-chevron-right"></i>
                         </div>
                         <ul class="menu-items submenu">
                             <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> Wearables Devices</li>
                             <li class="item"><a href="#printers">Smartwatches</a></li>
                             <li class="item"><a href="#monitors">Fitness Trackers</a></li>
                             <li class="item"><a href="#keyboards-mice">VR Headsets</a></li>
                            
                         </ul>
                    </li>


                         <li class="item">
                         <div class="submenu-item" onclick="toggleSubmenu(this)">
                             <span><i class=""></i>Consoles</span>
                             <i class="fa-solid fa-chevron-right"></i>
                         </div>
                         <ul class="menu-items submenu">
                             <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> Consoles</li>
                             <li class="item"><a href="#printers">Consoles</a></li>
                             <li class="item"><a href="#monitors">Console Accessories</a></li>
                         </ul>
                    </li>
                       <li class="item">
                         <div class="submenu-item" onclick="toggleSubmenu(this)">
                             <span><i class=""></i> Appliances</span>
                             <i class="fa-solid fa-chevron-right"></i>
                         </div>
                         <ul class="menu-items submenu">
                             <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> Appliances</li>
                             <li class="item">
                                 <div class="submenu-item" onclick="toggleSubmenu(this)">
                                     <span>Kitchen Appliances</span>
                                     <i class="fa-solid fa-chevron-right"></i>
                                 </div>
                                 <ul class="menu-items submenu">
                                     <li class="menu-title" onclick="goBack(this)"><i class="fa-solid fa-chevron-left"></i> Kitchen Appliances</li>
                                     <li class="item"><a href="#refrigerators">Refrigerators</a></li>
                                     <li class="item"><a href="#microwaves">Microwaves</a></li>
                                     <li class="item"><a href="#coffee-machines">Coffee Machines</a></li>
                                     <li class="item"><a href="#blenders">Blenders</a></li>
                                 </ul>
                             </li>
                             <li class="item"><a href="#vacuum-cleaners">Vacuum Cleaners</a></li>
                             <li class="item"><a href="#air-conditioners">Air Conditioners</a></li>
                         </ul>
                    </li>
                </ul>
            </div>
            <div class="sidebar-footer">
                <div class="cookie-notice">
                    <p>This website uses cookies to provide you with the best experience.</p>
                    <button class="accept-cookies" onclick="acceptCookies()">Accept</button>
                </div>
            </div>
        </nav>
        <main class="content">
            <section class="hero-carousel">
                <div class="hero-slides">
                    <div class="hero-slide active">
                        <a href="https://www.takealot.com/black-friday" target="_blank" class="hero-slide-link">
                            <picture>
                                <source media="(max-width: 480px)" srcset="https://consumer.huawei.com/dam/content/dam/huawei-cbg-site/ecommerce/za/2025/June/MEGA/WAP-1080x1152.webp">
                                <source media="(max-width: 768px)" srcset="https://consumer.huawei.com/dam/content/dam/huawei-cbg-site/ecommerce/za/2025/June/MEGA/WAP-1080x1152.webp">
                                <img src="https://consumer.huawei.com/dam/content/dam/huawei-cbg-site/ecommerce/za/2025/June/MEGA/WEB--3840x1136.webp" alt="Black Friday Deals" class="hero-image">
                            </picture>
                        </a>
                    </div>
                    <div class="hero-slide">
                        <a href="https://www.amazon.com/prime-day" target="_blank" class="hero-slide-link">
                            <picture>
                                <source media="(max-width: 480px)" srcset="https://hisense.co.za/wp-content/uploads/2025/05/100KV_1920x800-1024x427.jpg">
                                <source media="(max-width: 768px)" srcset="https://www.asus.com/WebsitesBanner/ZA/banners/store/acizy7bp3pbajipj/acizy7bp3pbajipj-0_0_tablet_0_1X.jpg?webp">
                                <img src="https://www.defy.co.za/content/dam/defy/za/images-defy-homepage/desktop/Defy_Homepage_Desktop-Blog-Article-Hero-1.png/jcr:content/renditions/original" alt="Prime Day Deals" class="hero-image">
                            </picture>
                        </a>
                    </div>
                    <div class="hero-slide">
                         <a href="https://www.takealot.com/tech-deals" target="_blank" class="hero-slide-link">
                             <picture>
                                 <source media="(max-width: 480px)" srcset="https://www.asus.com/WebsitesBanner/ZA/banners/store/acizy7bp3pbajipj/acizy7bp3pbajipj-0_0_mobile_0_1X.jpg?webp">
                                 <source media="(max-width: 768px)" srcset="https://www.asus.com/WebsitesBanner/ZA/banners/store/acizy7bp3pbajipj/acizy7bp3pbajipj-0_0_tablet_0_1X.jpg?webp">
                                 <img src="https://www.asus.com/WebsitesBanner/ZA/banners/store/acizy7bp3pbajipj/acizy7bp3pbajipj-0_0_desktop_0_1X.jpg?webp" alt="Tech Deals" class="hero-image">
                             </picture>
                         </a>
                    </div>
                    <div class="hero-slide">
                         <a href="https://www.amazon.com/home-appliances" target="_blank" class="hero-slide-link">
                             <picture>
                                 <source media="(max-width: 480px)" srcset="https://www.asus.com/WebsitesBanner/ZA/banners/store/mh69pfka5ufjjdyj/mh69pfka5ufjjdyj-0_0_mobile_0_1X.jpg">
                                 <source media="(max-width: 768px)" srcset="https://www.asus.com/WebsitesBanner/ZA/banners/store/mh69pfka5ufjjdyj/mh69pfka5ufjjdyj-0_0_tablet_0_1X.jpg">
                                 <img src="https://www.asus.com/WebsitesBanner/ZA/banners/store/mh69pfka5ufjjdyj/mh69pfka5ufjjdyj-0_0_desktop_0_1X.jpg" alt="Home Appliances Sale" class="hero-image">
                             </picture>
                         </a>
                    </div>
                </div>
                <div class="hero-indicators">
                    <span class="hero-indicator active" data-slide="0"></span>
                    <span class="hero-indicator" data-slide="1"></span>
                    <span class="hero-indicator" data-slide="2"></span>
                    <span class="hero-indicator" data-slide="3"></span>
                </div>
            </section>
            <section class="deals-section">
                <div class="section-header">
                    <h2 class="section-title"> Today's Best Deals On 
                        <img src="https://www.takealot.com/2cbdc3190194b57fa66049c9cd37d68bc3716afa/static/media/src/images/logo.svg-f6ccb4bbddf97d6.svg" alt="Takealot" class="store-logo">
                    </h2>
                </div>
                <div class="products-carousel" id="takealotCarousel">
                    <div class="products-slider" id="takealotSlider"></div>
                </div>
                <div class="carousel-indicators" id="takealotIndicators"></div>
            </section>
            <section class="deals-section">
                <div class="section-header">
                    <h2 class="section-title">
                        Today's Best Deals On 
                        <img src="https://static.vecteezy.com/system/resources/previews/012/681/601/non_2x/amazon-logotypetion-popular-online-shoping-icon-free-png.png" alt="Amazon" class="store-logo">
                    </h2>
                </div>
                <div class="products-carousel" id="amazonCarousel">
                    <div class="products-slider" id="amazonSlider"></div>
                </div>
                <div class="carousel-indicators" id="amazonIndicators"></div>
            </section>
        </main>
    </div>

    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

    <footer class="footer">
        <div class="footer-content">
            <div class="footer-section">
                <h3>About CompareHubPrices</h3>
                <ul>
                    <li><a href="#about">About Us</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Help & Support</h3>
                <ul>
                    <li><a href="#contact">Contact Us</a></li>
                    <li><a href="#faq">FAQs</a></li>
                    <li><a href="#privacy">Privacy Policy</a></li>
                    <li><a href="#terms">Terms of Service</a></li>
                </ul>
            </div>
            <div class="footer-section">
                <h3>Connect With Us</h3>
                <div class="social-icons">
                    <a href="#" aria-label="Facebook"><i class="fab fa-facebook"></i></a>
                    <a href="#" aria-label="Twitter"><i class="fab fa-twitter"></i></a>
                    <a href="#" aria-label="Instagram"><i class="fab fa-instagram"></i></a>
                </div>
                <div class="newsletter-section">
                    <h4>Get the Best Deals in Your Inbox</h4>
                    <form class="newsletter-form" onsubmit="subscribeNewsletter(event)">
                        <input type="email" placeholder="Enter your email address" required aria-label="Email address for newsletter">
                        <button type="submit"><i class="fas fa-paper-plane"></i> Subscribe</button>
                    </form>
                </div>
            </div>
        </div>
        <div class="footer-bottom">
            <p>&copy; 2025 CompareHub Prices. All rights reserved.</p>
        </div>
    </footer>

<script>
    // =======================================================
    //  GLOBAL SIDEBAR FUNCTIONS
    //  These are placed here so the onclick="" in your HTML can always find them.
    // =======================================================
    function toggleSidebar() {
        document.body.classList.toggle('sidebar-active');
    }

    function closeSidebar() {
        document.body.classList.remove('sidebar-active');
    }

    function toggleSubmenu(element) {
        // This allows one submenu to be open at a time.
        const parentItem = element.parentElement;
        if (!parentItem.classList.contains('active')) {
            const currentlyActive = document.querySelector('.sidebar .item.active');
            if (currentlyActive) {
                currentlyActive.classList.remove('active');
            }
        }
        parentItem.classList.toggle('active');
    }

    function goBack(element) {
        // Finds the closest parent 'item' and removes the active class to close the submenu.
        const parentItem = element.closest('.item');
        if (parentItem) {
            parentItem.classList.remove('active');
        }
    }


    // =======================================================
    //  PAGE INITIALIZATION LOGIC
    //  This code runs after the page content has loaded.
    // =======================================================
    document.addEventListener('DOMContentLoaded', function() {
        // ---------- CONFIGURATION ----------
        const API_BASE_URL = "https://w1yg1wc8cf.execute-api.af-south-1.amazonaws.com/prod";
        const DEALS_API_URL = 'https://xf9zlapr5e.execute-api.af-south-1.amazonaws.com/deals';

        // ---------- USER SESSION MANAGEMENT ----------
        async function handleUserSession() {
            try {
                const response = await fetch(`${API_BASE_URL}/userinfo`, {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    credentials: "include"
                });

                if (response.ok) {
                    const data = await response.json();
                    renderSidebarLogin(data.user);
                } else {
                    renderSidebarLogin(null);
                }
            } catch (error) {
                console.error("Error fetching user session:", error);
                renderSidebarLogin(null);
            }
        }

        function renderSidebarLogin(userInfo) {
            const sidebarLogin = document.getElementById('sidebarLogin');
            if (!sidebarLogin) return;

            if (userInfo) {
                const name = userInfo.name || userInfo.email.split('@')[0];
                const email = userInfo.email || '';
                const avatar = userInfo.picture || '';
                const initials = getAvatarInitials(userInfo);

                sidebarLogin.innerHTML = `
                    <div class="user-greeting fade-in">
                        <div class="user-avatar" style="cursor:pointer;" title="View Profile">
                            ${avatar ? `<img src="${avatar}" alt="Avatar">` : initials}
                        </div>
                        <div class="user-info">
                            <div class="user-name">${name}</div>
                            <div class="user-email">${email}</div>
                            <span class="sign-out" style="cursor:pointer;">Sign Out</span>
                        </div>
                    </div>
                `;
                sidebarLogin.querySelector('.sign-out').addEventListener('click', handleLogout);
                sidebarLogin.querySelector('.user-avatar').addEventListener('click', () => {
                    window.location.href = "profile.html";
                });
            } else {
                sidebarLogin.innerHTML = `
                    <a href="login.html" class="login-btn">
                        <i class="fas fa-sign-in-alt"></i>Login to CompareHub
                    </a>
                `;
            }
        }

        async function handleLogout(event) {
            event.preventDefault();
            const sidebarLogin = document.getElementById('sidebarLogin');
            sidebarLogin.innerHTML = 'Signing out...';
            try {
                await fetch(`${API_BASE_URL}/logout`, { method: "POST", credentials: "include" });
            } catch (error) {
                console.error("Logout request failed:", error);
            } finally {
                window.location.href = "index.html";
            }
        }

        function getAvatarInitials(userInfo) {
            const name = userInfo.name || userInfo.email.split('@')[0];
            if (userInfo.picture) return "";
            if (name) {
                const parts = name.split(' ');
                if (parts.length >= 2) return (parts[0][0] + parts[1][0]).toUpperCase();
                return name[0].toUpperCase();
            }
            return 'U';
        }

        // ---------- PAGE SETUP ----------
        function initializePage() {
            setBodyPadding();
            window.addEventListener('resize', setBodyPadding);
            document.getElementById('sidebarOverlay').addEventListener('click', closeSidebar); // Setup overlay click

            handleUserSession(); // Check login status
            
            initializeHeroCarousel();
            fetchDealsData();
            // Other setups can go here
        }

        function setBodyPadding() {
            const header = document.querySelector('.header');
            if (header) document.body.style.paddingTop = `${header.offsetHeight}px`;
        }

        function initializeHeroCarousel() {
            // Your existing hero carousel logic here...
        }

        async function fetchDealsData() {
            // Your existing deals fetching logic here...
        }

        // Run the page initialization
        initializePage();
    });
</script>

</body>
</html>
